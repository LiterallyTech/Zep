<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Zep Search Engine</title>
<link href="https://cdn.jsdelivr.net/npm/modern-normalize@2.0.0/modern-normalize.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
  --blur: 24px;
  --tint: rgba(255, 255, 255, 0.06);
  --border: rgba(255, 255, 255, 0.22);
  --highlight: rgba(255, 255, 255, 0.4);
  --text-primary: #e8e8ea;
  --text-secondary: #b9b9bb;
  --accent: #64b5ff;
  --radius: 14px;
  --bg-gradient: linear-gradient(135deg, #0e0e10 0%, #1d1f22 100%);
}

/* Base setup */
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Inter", "SF Pro Text", sans-serif;
  background: var(--bg-gradient);
  color: var(--text-primary);
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
}

/* Header */
header {
  width: 100%;
  text-align: center;
  padding: 1.2rem 0;
  font-weight: 600;
  font-size: 1.5rem;
  letter-spacing: 0.3px;
  background: var(--tint);
  backdrop-filter: blur(var(--blur));
  border-bottom: 1px solid var(--border);
  color: var(--text-primary);
}

/* Main container */
main {
  width: 90%;
  max-width: 720px;
  margin-top: 3rem;
  background: var(--tint);
  backdrop-filter: blur(var(--blur));
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: inset 0 0 0.5px var(--highlight), 0 4px 20px rgba(0,0,0,0.25);
  padding: 1.8rem 2rem;
}

/* Input */
input {
  width: 100%;
  padding: 0.9rem 1rem;
  border: 1px solid var(--border);
  border-radius: calc(var(--radius) - 4px);
  background: rgba(255,255,255,0.08);
  color: var(--text-primary);
  font-size: 1rem;
  outline: none;
  backdrop-filter: blur(calc(var(--blur) / 2));
  transition: border 0.15s ease;
}
input:focus {
  border-color: var(--accent);
}

/* Suggestion */
.suggestion {
  text-align: center;
  color: var(--text-secondary);
  margin-top: 0.8rem;
  font-size: 0.95rem;
}
.suggestion a {
  color: var(--accent);
  text-decoration: none;
}
.suggestion a:hover {
  text-decoration: underline;
}

/* Result items */
.result {
  background: rgba(255,255,255,0.08);
  backdrop-filter: blur(var(--blur));
  border: 1px solid var(--border);
  border-radius: var(--radius);
  margin-top: 1.2rem;
  padding: 1.2rem 1.4rem;
  transition: background 0.1s ease, border 0.1s ease;
}
.result:hover {
  background: rgba(255,255,255,0.12);
  border-color: rgba(255,255,255,0.28);
}
.result-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}
.result a {
  color: var(--accent);
  text-decoration: none;
  font-size: 1.15rem;
  font-weight: 500;
}
.result a:hover {
  text-decoration: underline;
}
.result p {
  color: var(--text-secondary);
  margin-top: 0.4rem;
  font-size: 0.92rem;
  line-height: 1.4;
}
.result-meta {
  margin-top: 0.4rem;
  font-size: 0.8rem;
  color: var(--text-secondary);
  display: flex;
  align-items: center;
}
.page-type {
  background: rgba(255,255,255,0.15);
  padding: 0.2rem 0.6rem;
  border-radius: 6px;
  margin-right: 0.6rem;
}

/* Vote buttons */
.vote-buttons {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.25rem;
}
.vote-btn {
  background: transparent;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  font-size: 1.05rem;
  padding: 0.2rem;
  transition: color 0.1s ease, transform 0.1s ease;
}
.vote-btn:hover {
  color: var(--accent);
  transform: scale(1.15);
}
.vote-btn.positive.active {
  color: #3ee689;
}
.vote-btn.negative.active {
  color: #ff5b7d;
}
.vote-score {
  font-size: 0.75rem;
  color: var(--text-secondary);
}

/* Notification */
.notification {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: rgba(30,30,30,0.75);
  backdrop-filter: blur(calc(var(--blur) / 1.5));
  border: 1px solid var(--border);
  color: var(--text-primary);
  padding: 0.8rem 1.4rem;
  border-radius: calc(var(--radius) - 6px);
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.25s ease;
}
.notification.show {
  opacity: 1;
  transform: translateY(0);
}
</style>
</head>
<body>
  <header>Zep</header>
  <main>
    <input id="search" type="text" placeholder="Search your sites..." autocomplete="off" />
    <div id="suggestion" class="suggestion"></div>
    <div id="results"></div>
  </main>
  <div id="notification" class="notification"></div>

<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
<script>
const dataURL = "https://literallytech.github.io/Zep/data/index.json";
const votesURL = "https://literallytech.github.io/Zep/data/votes.json";
let entries = [];
let fuse;
let userVotes = {};

async function loadData() {
  try {
    const [dataRes, votesRes] = await Promise.all([
      fetch(dataURL + "?t=" + Date.now()),
      fetch(votesURL + "?t=" + Date.now())
    ]);
    const data = await dataRes.json();
    const votes = await votesRes.json();
    entries = data.map(entry => {
      const voteData = votes.find(v => v.url === entry.url);
      return {
        ...entry,
        voteScore: voteData ? voteData.score : 0,
        positiveVotes: voteData ? voteData.positive : 0,
        negativeVotes: voteData ? voteData.negative : 0
      };
    });
    entries.sort((a, b) => b.voteScore - a.voteScore);
    fuse = new Fuse(entries, {
      keys: [
        { name: "name", weight: 0.3 },
        { name: "desc", weight: 0.2 },
        { name: "keywords", weight: 0.15 },
        { name: "title", weight: 0.15 },
        { name: "content", weight: 0.15 },
        { name: "headings", weight: 0.05 }
      ],
      threshold: 0.35,
      includeScore: true
    });
  } catch (err) {
    document.getElementById("results").innerHTML =
      "<p style='text-align:center;color:#777;'>Failed to load data.</p>";
  }
}

function search(query) {
  if (!query.trim()) {
    document.getElementById("results").innerHTML = "";
    document.getElementById("suggestion").innerHTML = "";
    return;
  }
  const results = fuse.search(query);
  const container = document.getElementById("results");
  const suggestionBox = document.getElementById("suggestion");

  if (!results.length) {
    container.innerHTML = "<p style='text-align:center;color:#999;'>No results found.</p>";
    suggestionBox.innerHTML = "";
    return;
  }

  const bestMatch = results[0].item;
  if (results[0].score > 0.25) {
    suggestionBox.innerHTML = `Did you mean: <a onclick="setSearch('${bestMatch.name}')">${bestMatch.name}</a>?`;
  } else {
    suggestionBox.innerHTML = "";
  }

  container.innerHTML = results
    .map(r => {
      const item = r.item;
      const hasVoted = userVotes[item.url];
      return `
        <div class="result">
          <div class="result-header">
            <div class="result-title">
              <a href="${item.url}" target="_blank">${item.name}</a>
              <div class="result-meta">
                ${item.pageType ? `<span class="page-type">${item.pageType}</span>` : ''}
                ${item.voteScore !== 0 ? `<span>Score: ${item.voteScore > 0 ? '+' : ''}${item.voteScore}</span>` : ''}
              </div>
              <p>${item.desc || item.description || item.title || ""}</p>
            </div>
            <div class="vote-buttons">
              <button class="vote-btn positive ${hasVoted === 'positive' ? 'active' : ''}" onclick="vote('${item.url}', 'positive')">
                <i class="fas fa-thumbs-up"></i>
              </button>
              <div class="vote-score">${item.positiveVotes || 0}</div>
              <button class="vote-btn negative ${hasVoted === 'negative' ? 'active' : ''}" onclick="vote('${item.url}', 'negative')">
                <i class="fas fa-thumbs-down"></i>
              </button>
              <div class="vote-score">${item.negativeVotes || 0}</div>
            </div>
          </div>
        </div>
      `;
    })
    .join("");
}

function vote(url, type) {
  userVotes[url] = type;
  document.querySelectorAll('.result').forEach(el => {
    const link = el.querySelector('a').href;
    if (link === url) {
      el.querySelector('.vote-btn.positive').classList.toggle('active', type === 'positive');
      el.querySelector('.vote-btn.negative').classList.toggle('active', type === 'negative');
    }
  });
  showNotification("Vote recorded");
  fetch('https://literallytech.github.io/Zep/api/collect-vote', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ url, type, timestamp: Date.now() })
  });
}

function showNotification(message) {
  const n = document.getElementById("notification");
  n.textContent = message;
  n.classList.add("show");
  setTimeout(() => n.classList.remove("show"), 2500);
}

function setSearch(text) {
  document.getElementById("search").value = text;
  search(text);
}

document.getElementById("search").addEventListener("input", e => search(e.target.value));
loadData();
</script>
</body>
</html>
